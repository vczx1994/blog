(window.webpackJsonp=window.webpackJsonp||[]).push([[205],{712:function(s,t,a){"use strict";a.r(t);var e=a(42),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"sequelize-v5-升级记录以及编译时与运行时问题解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sequelize-v5-升级记录以及编译时与运行时问题解决方案"}},[s._v("#")]),s._v(" sequelize V5 升级记录以及编译时与运行时问题解决方案")]),s._v(" "),a("p",[s._v("最近把项目中的 sequelize 由 "),a("code",[s._v("4.38.0")]),s._v(" 升级到了 "),a("code",[s._v("5.8.7")]),s._v("，不过最后事实告诉我这真是一个错误的决定，说多了全是泪，升级记录如下")]),s._v(" "),a("h2",{attrs:{id:"_01-删包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01-删包"}},[s._v("#")]),s._v(" 01 删包")]),s._v(" "),a("p",[s._v("从 package.json 中删掉 sequelize 以及 @types/sequelize")]),s._v(" "),a("h2",{attrs:{id:"_02-过文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-过文档"}},[s._v("#")]),s._v(" 02 过文档")]),s._v(" "),a("p",[s._v("大致过一遍官方升级文档 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/upgrade-to-v5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://docs.sequelizejs.com/manual/upgrade-to-v5.html"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"_03-npm-install"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_03-npm-install"}},[s._v("#")]),s._v(" 03 npm install")]),s._v(" "),a("p",[s._v("由于官方提供了 "),a("code",[s._v("typescript")]),s._v(" 的支持，不需要在安装 "),a("code",[s._v("@types/sequelize")]),s._v("。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sequelize\n")])])]),a("h2",{attrs:{id:"_04-tsc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_04-tsc"}},[s._v("#")]),s._v(" 04 tsc")]),s._v(" "),a("p",[s._v("由于使用了 "),a("code",[s._v("typescript")]),s._v(" 编译，解决问题。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ tsc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nFound "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1361")]),s._v(" errors.\n")])])]),a("h2",{attrs:{id:"_05-new-sequelize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_05-new-sequelize"}},[s._v("#")]),s._v(" 05 new Sequelize")]),s._v(" "),a("p",[s._v("从数据库初始化入手，解决一些 Sequelize 实例化时的类型问题")]),s._v(" "),a("h2",{attrs:{id:"_06-anymodel-anypropmodel-sequelize-define"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_06-anymodel-anypropmodel-sequelize-define"}},[s._v("#")]),s._v(" 06 AnyModel & AnyPropModel & Sequelize.define")]),s._v(" "),a("p",[s._v("由于 "),a("code",[s._v("sequelize")]),s._v(" 的 "),a("code",[s._v("type")]),s._v(" 此时由官方维护，重新定义了 "),a("code",[s._v("Model")]),s._v(" 等类型。")]),s._v(" "),a("p",[s._v("虽然目前官方已经支持了对 "),a("code",[s._v("Model")]),s._v(" 的 typescript 支持，但是为了更小幅度的升级，仍然使用 "),a("code",[s._v("Sequelize.define")]),s._v("。")]),s._v(" "),a("p",[s._v("以后将 "),a("code",[s._v("AnyPropModel")]),s._v(" 逐渐替换为 "),a("code",[s._v("UserModel")]),s._v(" 等真实的 Model。")]),s._v(" "),a("p",[s._v("根据文档，对 "),a("code",[s._v("Model")]),s._v(" 以及 "),a("code",[s._v("Sequelize.define")]),s._v(" 做以下更改。")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AnyPropModel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Model")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("AnyModel")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typeof")]),s._v(" Model "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("values"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" options"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" BuildOptions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" AnyPropModel"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Models")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Record"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" AnyModel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" UserModel "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("AnyModel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("sequelize"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("define")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'MyDefineModel'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  id"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    primaryKey"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("INTEGER")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("UNSIGNED")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("更改之后再次编译.")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ tsc\nFound "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("898")]),s._v(" errors.\n")])])]),a("h2",{attrs:{id:"_07-归并与分类-逐个击破"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_07-归并与分类-逐个击破"}},[s._v("#")]),s._v(" 07 归并与分类，逐个击破")]),s._v(" "),a("p",[s._v("对 typescript 编译出来的错误信息进行格式化并做统计，以下为格式化数据，抽出 "),a("code",[s._v("{ file, code, message }")])]),s._v(" "),a("blockquote",[a("p",[s._v("本来也想抽出 lines，没有成功...")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ tsc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'error TS'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" jq -R -c -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'split(\""),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('") | map(capture("(?<file>.+): error (?<code>.+): (?<message>.+)")) | .[]\'')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" build.jsonl\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("head")]),s._v(" -3 build.jsonl\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bin/demo.ts(278,23)"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2351"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Cannot use 'new' with an expression whose type lacks a call or construct signature.\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src/helpers/one.ts(36,23)"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2576"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'literal' is a static member of type 'Sequelize'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"src/helpers/two.ts(188,24)"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2576"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'fn' is a static member of type 'Sequelize'\"")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),a("p",[s._v("根据格式化信息，对相同 code 的错误进行分类，先解决错误率最高的五类")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" build.jsonl "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" jq -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'group_by(.code) | map({count: length, code: .[0].code, message: .[0].message}) | sort_by(.count) | .[]'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS6133"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"'DataTypes' is declared but its value is never read.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2339"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'id' does not exist on type 'object'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("82")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2709"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Cannot use namespace 'DataTypes' as a type.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS7006"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Parameter 'e' implicitly has an 'any' type.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("142")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2576"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'col' is a static member of type 'Sequelize'\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("335")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2531"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Object is possibly 'null'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h2",{attrs:{id:"_08-ts2576-sequelize-prototype-sequelize"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_08-ts2576-sequelize-prototype-sequelize"}},[s._v("#")]),s._v(" 08 TS2576: Sequelize.prototype -> Sequelize")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'col' is a static member of type 'Sequelize'\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'literal' is a static member of type 'Sequelize'\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Property 'or' is a static member of type 'Sequelize'\"")]),s._v("\n")])])]),a("p",[s._v("根据文档 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/upgrade-to-v5.html#sequelize",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://docs.sequelizejs.com/manual/upgrade-to-v5.html#sequelize"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("Sequelize 示例上的很多方法变成了 static method.")]),s._v(" "),a("p",[s._v("借助 "),a("code",[s._v("VS Code")]),s._v(" 与其内置的命令行工具，输入命令 "),a("code",[s._v("tsc | grep 2576")]),s._v(" 可以更快解决问题:")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("tsc | grep 2576")]),s._v(" 提供所有的此类问题与行号")]),s._v(" "),a("li",[a("code",[s._v("VS Code")]),s._v(" 可以根据行号快速定位")])]),s._v(" "),a("p",[s._v("但不管怎么说，这还是一个体力活......")]),s._v(" "),a("h2",{attrs:{id:"_09-ts2339-model-的废弃方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_09-ts2339-model-的废弃方法"}},[s._v("#")]),s._v(" 09 TS2339 Model 的废弃方法")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("Property "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'findById'")]),s._v(" does not exist on "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'AnyModel'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nProperty "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'find'")]),s._v(" does not exist on "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'AnyModel'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nProperty "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'id'")]),s._v(" does not exist on "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'AnyPropModel | null'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nProperty "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'LOCK'")]),s._v(" does not exist on "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Transaction'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])])]),a("p",[s._v("这个在升级文档中也提到过 "),a("a",{attrs:{href:"http://docs.sequelizejs.com/manual/upgrade-to-v5.html#model",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://docs.sequelizejs.com/manual/upgrade-to-v5.html#model"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("至于替换也是一个体力活，再次编译")]),s._v(" "),a("p",[a("strong",[s._v("Found 753 errors.")])]),s._v(" "),a("h2",{attrs:{id:"_10-ts2531-object-is-possibly-null"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-ts2531-object-is-possibly-null"}},[s._v("#")]),s._v(" 10 TS2531 Object is possibly 'null'")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ tsc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2531")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("406")]),s._v("\n")])])]),a("p",[s._v("再次统计下此问题的个数，比刚才统计时多了一百多")]),s._v(" "),a("p",[a("strong",[s._v("我们总是在不停地解决 Bug 的过程中引入新的 Bug。在解决旧 Bug 的过程中总有产生新 Bug 的风险")])]),s._v(" "),a("p",[a("code",[s._v("findById")]),s._v(" 更改之后有更多的问题显现出来，是因为没有对返回的数据做不存在断言处理，如下例所示")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 此时 user 可能不存在，可能报错")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" id "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id\n")])])]),a("p",[s._v("在解决问题之前，我先分析下原因")]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("rejectOnEmpty")]),s._v(" 来修正它，他能保证数据一定存在")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" models"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("User"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("findOne")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  rejectOnEmpty"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[s._v("接下来就是体力活了:")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("tsc | grep 2531")]),s._v(" 提供所有的此类问题与行号")]),s._v(" "),a("li",[a("code",[s._v("VS Code")]),s._v(" 根据行号快速定位")]),s._v(" "),a("li",[a("code",[s._v("gd")]),s._v(" vim 的 "),a("code",[s._v("Go to Def")]),s._v(" 可以快速定位到出问题的变量定义处")]),s._v(" "),a("li",[a("code",[s._v('"0p')]),s._v(" 使用 vim 把 "),a("code",[s._v("rejectOnEmpty")]),s._v(" 至于0号寄存器，快速粘贴")]),s._v(" "),a("li",[a("code",[s._v("==")]),s._v(" vim 进行格式化")])]),s._v(" "),a("p",[s._v("再次编译:")]),s._v(" "),a("p",[a("strong",[s._v("Found 335 errors.")])]),s._v(" "),a("h2",{attrs:{id:"_11-migration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-migration"}},[s._v("#")]),s._v(" 11 migration")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("TS2709: Cannot use namespace "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'DataTypes'")]),s._v(" as a "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v("\n")])])]),a("p",[s._v("这都是在 migration 文件中的内容，既然数据库迁移脚本已经执行过了，它其实也没多大用处了，我觉得不改也可以了...")]),s._v(" "),a("p",[a("strong",[s._v("另外，migration 这种数据库迁移脚本是不是可以单独从项目中抽出来，有两个原因")])]),s._v(" "),a("ol",[a("li",[s._v("它是一次性脚本")]),s._v(" "),a("li",[s._v("一个数据库有可能对应多个后端应用")])]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" QueryInterface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" DataTypes "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sequelize'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("up")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("queryInterface"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" QueryInterface"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" Sequelize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" DataTypes"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("全局替换")]),s._v(" "),a("p",[a("code",[s._v("Sequelize: DataTypes -> sequelize: typeof Sequelize")])]),s._v(" "),a("p",[a("strong",[s._v("Found 216 errors.")])]),s._v(" "),a("h2",{attrs:{id:"_12-implicitly-any"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-implicitly-any"}},[s._v("#")]),s._v(" 12 implicitly any")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("TS7006 Parameter "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'item'")]),s._v(" implicitly has an "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'any'")]),s._v(" type.\n")])])]),a("p",[s._v("解决后再次编译")]),s._v(" "),a("p",[a("strong",[s._v("Found 185 errors.")])]),s._v(" "),a("h2",{attrs:{id:"_13-使用-sed-批量替换-op"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-使用-sed-批量替换-op"}},[s._v("#")]),s._v(" 13 使用 sed 批量替换 Op")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 替换前")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" $lte"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$lte'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("$lte "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 替换后")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Op"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Op"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nwhere"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Op"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("lte"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])])]),a("p",[s._v("写一段 "),a("code",[s._v("sed")]),s._v(" 脚本来批量替换")]),s._v(" "),a("p",[s._v("再次编译")]),s._v(" "),a("p",[a("strong",[s._v("Found 412 errors.")])]),s._v(" "),a("h2",{attrs:{id:"_14-补充-op"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-补充-op"}},[s._v("#")]),s._v(" 14 补充 Op")]),s._v(" "),a("p",[s._v("以上错误的原因过多是因为批量替换成 "),a("code",[s._v("Op")]),s._v(" 后提示 "),a("code",[s._v("Op")]),s._v(" 不存在")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" Op "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sequelize'")]),s._v("\n")])])]),a("h2",{attrs:{id:"_15-再次统计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-再次统计"}},[s._v("#")]),s._v(" 15 再次统计")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ tsc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'error TS'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" jq -R -s "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'split(\""),a("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('") | map(capture("(?<file>.+): error (?<code>.+): (?<message>.+)")) | group_by(.code) | map({count: length, code: .[0].code, message: .[0].message}) | sort_by(.count) | .[]\'')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2684"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"The 'this' context of type 'typeof Model' is not assignable to method's 'this' of type '(new () => Model<{}, {}>) & typeof Model'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2322"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Type 'true' is not assignable to type 'false'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2694"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Namespace '"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("/Users/shanyue/backend/node_modules/sequelize/types/index"),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("' has no exported member 'AnyFindOptions'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2532"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Object is possibly 'undefined'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"code"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TS2304"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"message"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"Cannot find name 'Op'.\"")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("p",[s._v("都是一些小问题了，逐个解决")]),s._v(" "),a("h2",{attrs:{id:"_16-git-diff"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-git-diff"}},[s._v("#")]),s._v(" 16 git diff")]),s._v(" "),a("p",[s._v("统计下修改了多少内容")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("diff")]),s._v(" master --shortstat\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("199")]),s._v(" files changed, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1784")]),s._v(" insertions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("+"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1411")]),s._v(" deletions"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("h2",{attrs:{id:"_17-运行时问题-postgres-range"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_17-运行时问题-postgres-range"}},[s._v("#")]),s._v(" 17 运行时问题: postgres range")]),s._v(" "),a("p",[s._v("以上编译时的问题解决了，最令人头疼的还是运行时问题了")]),s._v(" "),a("p",[s._v("这次碰到的是 postgres 的 "),a("code",[s._v("range")]),s._v(" 这个数据类型")]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更改前")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 更改后")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  inclusive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  value"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  inclusive"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("p",[a("strong",[s._v("但是如果对数据库的每个 Model 都加上 type 的话，这个问题就可以在编译时解决")])]),s._v(" "),a("h2",{attrs:{id:"_18-运行时问题-undefined-in-where"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_18-运行时问题-undefined-in-where"}},[s._v("#")]),s._v(" 18 运行时问题: undefined in where")]),s._v(" "),a("p",[s._v("在 where 中遇到 "),a("code",[s._v("undefined")]),s._v(" 会抛出异常。"),a("a",{attrs:{href:"https://github.com/sequelize/sequelize/pull/9548/files",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/sequelize/sequelize/pull/9548/files"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("使用 "),a("code",[s._v("_.pickBy")]),s._v(" 过滤掉 "),a("code",[s._v("undefined")])]),s._v(" "),a("div",{staticClass:"language-typescript extra-class"},[a("pre",{pre:!0,attrs:{class:"language-typescript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" where "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pickBy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" x "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[a("strong",[s._v("当然，如果 typescript 做的比较严格的话，这个问题也可以避免")])]),s._v(" "),a("h2",{attrs:{id:"_19-运行时问题-assign-op-ne-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_19-运行时问题-assign-op-ne-3"}},[s._v("#")]),s._v(" 19 运行时问题: _.assign({ [Op.ne]: 3 })")]),s._v(" "),a("p",[a("code",[s._v("_.assign")]),s._v(" 会丢失 Symbol 属性，使用 "),a("code",[s._v("Object.assign")]),s._v(" 代替")]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("欢迎关注我的公众号"),a("strong",[s._v("山月行")]),s._v("，在这里记录着我的技术成长，欢迎交流")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://shanyue.tech/qrcode.jpg",alt:"欢迎关注公众号山月行，在这里记录我的技术成长，欢迎交流"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);