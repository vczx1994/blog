(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{400:function(s,t,a){s.exports=a.p+"assets/img/elk-db-low-query.e0ad8b8f.png"},531:function(s,t,a){"use strict";a.r(t);var r=a(42),e=Object(r.a)({},(function(){var s=this,t=s.$createElement,r=s._self._c||t;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("p",[s._v("date: 2020-04-10 14:00")]),s._v(" "),r("hr"),s._v(" "),r("h1",{attrs:{id:"orm-层分页查询过慢优化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#orm-层分页查询过慢优化"}},[s._v("#")]),s._v(" ORM 层分页查询过慢优化")]),s._v(" "),r("p",[s._v("这是山月修改的第三千七百六十五个bug")]),s._v(" "),r("h2",{attrs:{id:"情景再现"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#情景再现"}},[s._v("#")]),s._v(" 情景再现")]),s._v(" "),r("p",[s._v("今天产品在生产环境例行巡视并且与往常一样点点点时，发现某一页数据加载过慢，于是照例找到了我。")]),s._v(" "),r("p",[s._v("借助于山月我自己搭建的高效率的性能查询平台，很快就根据慢接口的 API 与 requestId 定位到了瓶颈相关 SQL，并分析如下。")]),s._v(" "),r("p",[s._v("相关 API 是关于请求数据库某资源的分页数据，但并不是 offset 过大问题，而问题出现在 ORM 生成的 SQL 上。")]),s._v(" "),r("h2",{attrs:{id:"捉虫"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#捉虫"}},[s._v("#")]),s._v(" 捉虫")]),s._v(" "),r("p",[r("img",{attrs:{src:a(400),alt:"通过 requestId 找到对应的慢 SQL"}})]),s._v(" "),r("p",[s._v("该 API 请求资源 "),r("code",[s._v("Practice")]),s._v(" 分页数据，在 "),r("code",[s._v("ORM")]),s._v(" 层使用了 "),r("code",[s._v("sequelize")]),s._v("，并通过 "),r("code",[s._v("findAndCountAll")]),s._v(" 获取资源总数及列表。")]),s._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[s._v("Practice"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("findAndCountAll")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  where"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    status"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    column_a_id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    column_b_id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  distinct"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  include"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    model"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PracticeRef\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    model"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" PracticeSchedule\n  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  limit"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  offset"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),r("p",[s._v("由上可见，"),r("code",[s._v("Practice")]),s._v(" 资源关联了四个表，从日志中可以得知生成的 "),r("code",[s._v("SQL")]),s._v(" 如下")]),s._v(" "),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice_ref"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ref"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ref"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice_id"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEFT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OUTER")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("JOIN")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice_schedule"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"schedules"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"schedules"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"schedules"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"user_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10086")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"column_a_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"column_b_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),r("p",[s._v("通过 "),r("code",[s._v("exaplain")]),s._v(" 分析，发现 "),r("code",[s._v("schedule")]),s._v(" 全表扫描，导致 "),r("code",[s._v("totalCost")]),s._v(" 过大，从执行计划还可以看出与 schedules 表关联还没有索引，造成数据索引时间过长")]),s._v(" "),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" QUERY "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PLAN")]),s._v("                                                                                                              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------------|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Limit")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14500.36")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14500")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".38")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Aggregate  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14500.36")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14500")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".38")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14500")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".36")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".14496")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".02")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v(" Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" schedules"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("practice_id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Seq Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".561")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".19")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                           Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subject_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Seq Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice_schedule schedules  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".13934")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".06")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("61")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                           Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7411238")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" ref_practice_index "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice_ref ref "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXPLAIN")]),s._v("\n")])])]),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" QUERY "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PLAN")]),s._v("                                                                                                        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Aggregate  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1118.39")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1118")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".40")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.01")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1118")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".38")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.72")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1114")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".04")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Seq Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".520")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".80")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subject_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Bitmap Heap Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" schedule schedules  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.72")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".593")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".23")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     Recheck Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" practice_id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7411238")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Bitmap "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" schedule_practice_id_idx  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".5")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".72")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("173")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                           "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" practice_id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" question_practice_index "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" question questions  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------------------------------------------------------------------------------+")]),s._v("\n")])])]),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" QUERY "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PLAN")]),s._v("                                                                                                                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Aggregate  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("533.60")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".533")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".61")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.71")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".533")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".60")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.42")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".529")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".26")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Seq Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".520")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".80")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subject_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" schedule_practice_id_user_id_idx "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" schedule schedules  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.42")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".45")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7411238")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" question_practice_index "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" question questions  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n")])])]),r("p",[s._v("0.01s")]),s._v(" "),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" QUERY "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PLAN")]),s._v("                                                                                                                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Aggregate  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.11")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".21")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".12")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                                    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.00")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".21")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Nested "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Loop")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Left")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Join")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.71")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".16")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".76")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" practice_subject_id_topic_id_idx "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subject_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" schedule_practice_id_user_id_idx "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" schedule schedules  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.42")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".45")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                     "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("user_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7411238")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Only Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" question_practice_index "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" question questions  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".4")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("               "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("practice_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("id"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----------------------------------------------------------------------------------------------------------------------------------+")]),s._v("\n")])])]),r("p",[s._v("然而实际上呢，我们只需要一个 "),r("code",[s._v("count")]),s._v(" 聚合函数用来获取分页的总页数")]),s._v(" "),r("ol",[r("li",[r("code",[s._v("dinstinct practice.id")]),s._v("，表明无需关心关联表的个数")]),s._v(" "),r("li",[r("code",[s._v("where")]),s._v(" 全在 "),r("code",[s._v("practice")]),s._v(" 表上，表明只需要查询 "),r("code",[s._v("practice")])])]),s._v(" "),r("p",[s._v("因此，我们完全可以只在 "),r("code",[s._v("Practice")]),s._v(" 表中进行 "),r("code",[s._v("count")]),s._v(" 查询")]),s._v(" "),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------------------------------------------------------------------------------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" QUERY "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PLAN")]),s._v("                                                                                                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------------------------------------------------------------------------------------------|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Aggregate  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.31")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".32")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Scan "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" practice_subject_id_topic_id_idx "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),s._v(" practice "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("  "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cost"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.29")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".8")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".31")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" width"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Index")]),s._v(" Cond: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("subject_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("topic_id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("111")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("         Filter: "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v("::"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("text")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------------------------------------------------------------------------------------------------------+")]),s._v("\n")])])]),r("h2",{attrs:{id:"解决"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解决"}},[s._v("#")]),s._v(" 解决")]),s._v(" "),r("p",[s._v("通过 ORM 把 "),r("code",[s._v("findAndCountAll")]),s._v(" 分为两个 API 分别查询")]),s._v(" "),r("div",{staticClass:"language-js extra-class"},[r("pre",{pre:!0,attrs:{class:"language-js"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" records "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" Practice"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("findAll")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" count "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("await")]),s._v(" Practice"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),r("p",[s._v("优化后的查询如下，大幅度解决了查询速度")]),s._v(" "),r("div",{staticClass:"language-sql extra-class"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("count")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DISTINCT")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"count"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"practice"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("AS")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"status"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Visible'")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"column_a_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Practice"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"column_b_id"')]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),r("h2",{attrs:{id:"反思"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#反思"}},[s._v("#")]),s._v(" 反思")]),s._v(" "),r("blockquote",[r("p",[s._v("明者远见于未萌，而智者避危于未形。")])]),s._v(" "),r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),r("ol",[r("li",[s._v("基础运维建设可以大幅提高工作效率，如无法查找某条 API 请求")]),s._v(" "),r("li",[r("code",[s._v("findAndCountAll")]),s._v(" 有时可单独对 "),r("code",[s._v("count")]),s._v(" 进行优化")]),s._v(" "),r("li",[s._v("养成使用 "),r("code",[s._v("explain")]),s._v(" 优化数据库的习惯，并了解常用的 "),r("code",[s._v("Index")]),s._v(" 及 "),r("code",[s._v("Scan Type")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);